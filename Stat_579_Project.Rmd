---
title: "Stat 579 Project"
author: "Andrew Maloney"
date: "10/23/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
# Can use this function to quickly install and load all packages

#Load required Packages



#packages <- c("readxl", "tidyverse", "purrr", "shiny", "shinydashboard",
             # "shinydashboardPlus", "shinythemes", "stringr", "ggplot2", "plotly", "lubridate",
              #"viridis", "rayshader")

#for (pkgs in packages){
# if(!require(pkgs, character.only = TRUE)){ # Condition 
#  install.packages(pkgs) # Install if not in set 1
# library(pkgs) # Load if installed
#}
#}





```


```{r, warning=FALSE}


library(readxl)
library(tidyverse)
library(purrr) #optional
library(shiny) #optional
library(shinydashboard) #optional
library(shinydashboardPlus) #optional
library(shinythemes) #optional
library(stringr)
library(ggplot2)
library(plotly)
library(lubridate)
library(viridis) #optional
library(rayshader) #optional (Heike hates this package but I love it lol)

library(naniar)

library(tidyr)

```


```{r, warning=FALSE}

df <- read_excel("all_lawsuits_2008_to_2019.xlsx")

#df$Date_to_Comptroller <- as_date(df$Date_to_Comptroller)

head(df)
```

#### Case Number: Identification of the case
#### Payee: Person or group of people who is/are owed money 
#### Payment Amount:  Amount paid to the Payee
#### Fees and Costs: Costs associated with the settlement
#### Primary Cause: Short insight behind the settlement
#### City Department Involved: Department of Chicago involved in the settlement
#### Disposition: Final type of Settlement
#### Tort: Number of wrongful acts or infringement of rights leading to civil legal liability(big no no)
#### Date to Comptroller: Date to comptroller ?
#### Year to Comptroller: Year to Comptroller ?
#### Monto to Comptroller: Month to Comptroller?
#### Payment Amount(Millions): Payment amount in terms of millions of dollars
#### Fees and Costs(Millions): Fees and Costs in terms of millions of dollars
#### Total Paid: Payment Amount + Fees and Cost
#### Total Paid(millions): Total Paid in terms of millions of dollars

```{r}
#Spaces in column names are a no no for me so I am going to replace them with underscores using gsub

names(df) <- gsub(" ", "_", names(df))

```


```{r}
# Let's first investigate the missing values throughtout the data set


vis_miss(df)

 df %>%
  gather(key = "columns", value = "column_values") %>%
    mutate(missing_values = is.na(column_values)) %>%
      group_by(columns) %>%
        mutate(total_values = n()) %>%
          group_by(columns, missing_values, total_values)%>%
       summarise(number_of_missing_values = n()) %>%
        #filter(missing_values == TRUE) %>% select(-missing_values) %>% can see total number of NA values for each column
          mutate(percent_missing = (number_of_missing_values/total_values) * 100) %>%
  ggplot(aes(x = reorder(columns, desc(percent_missing)), y = percent_missing, fill = missing_values))+
    geom_bar(stat = "identity")+
      coord_flip()+ 
        ggtitle("Percentage of Missing Values throughout the Dataset")+
          xlab("Column Names")+ylab("Percentage")+
            theme_bw() + scale_fill_manual(values = c("Chartreuse3", "firebrick2"))

#ggsave(xx, "missing_values_pic.png")

# 0.48% missing values for Case_Number
# <0.1% missing values for Payment_Amount
# <0.1% missing values for Fees_and_Costs
# <0.1% missing values for Primary_Cause
# 50.36% missing values for Tort
# <0.1% missing values for Date_to_Comptroller
# <0.1% missing values for Year_to_Comptroller
# <0.1% missing values for Month_to_Comptroller
# <0.1% missing values for Payment_Amount(millions)
# <0.1% missing values for Fees_and_Costs(millions)
# <0.1% missing values for Total_Paid
# <0.1% missing values for Total_Paid(Millsions)
# 100 % missing values for Payment_Fund, Effective_Data, Due_Date, and Client_Department

# 3 Columns contain no missing values
# 16 columns contain missing values, 4 out of those 16 columns are completely missing

```



```{r}
# Columns that are 100% missing data are of no use so I am removing them

df <- df %>% select(-Payment_Fund, -Effective_Date, -Due_Date, -Client_Department)

```

## Analysis of remaing missing values

```{r}

#Tort column is easy fix, NA should be 0

df <- df %>%
  mutate(Tort = ifelse(is.na(Tort) == TRUE, 0, Tort))


```

```{r}

df %>%
  gather(key = "columns", value = "column_values") %>%
    mutate(missing_values = is.na(column_values)) %>%
          group_by(columns, missing_values)%>%
       summarise(number_of_missing_values = n()) %>%
        filter(missing_values == TRUE) %>% select(-missing_values) 


# There are only 79 missing values left.  Do these values have a pattern or are they just missing

df %>% filter(is.na(Case_Number) == TRUE) #Looks like case Numbers are missing on there own (1)

df %>% filter(is.na(Date_to_Comptroller) == TRUE) # Date_to_Comptroller is the joined Year, Month, including day, they each have 2 missing values making a total of 6.  This should be re-separated to include day names could be better as well. (3)

df %>% filter(is.na(Fees_and_Costs) == TRUE) # Fees_and_cost and Fees_and_costs(millions) are linked.  Can remove missing values or take average value based on Primary_Cause (2)

df %>% filter(is.na(Payment_Amount) == TRUE) # Payment_Amount and Payment_Amount(millions) are linked.  The Fees_and_Costs for this observation are really high, could be an entry error.  Need to look at average Payment_Amount and Fees_Costs (2) associated with "UNLAWFUL SEARCH/FALSE ARREST

df %>% filter(is.na(Total_Paid) == TRUE) # One of the observations for the row containing missing Total_Paid has a valid Payment amount. Possible Entry issue. The other one is linked with the really high Fees_and_Costs observation.  Therefore it could be possible that 3 observations are linked across Total_Paid, Payment_Amount, and Fees_and_Costs (2)

df %>% filter(is.na(Primary_Cause) == TRUE) # Missing primary cost deals with Transportation department and has a date.  Probably can look up or remove

```

```{r}

df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("ANIM CARE & CONTROL", "ANIMAL C0NTROL", "ANIMAL CARE/CONTROL"), "ANIMAL CONTROL", df$City_Department_Involved) #Animal Services

df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("BUS AFFAIRS & LCNSE", "BUS. AFFAIRS/CONS. SERV."), "BUS AFFAIRS", df$City_Department_Involved) # Bus Services

df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("DEPT OF AVIATION"), "AVIATION", df$City_Department_Involved) #Aviation

df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("CULT AFF & SPEC EVNT"), "CULTURAL AFFAIRS", df$City_Department_Involved) #Cultural Affairs

df$City_Department_Involved <-
  ifelse(df$City_Department_Involved %in% c("EMER MGMT & COMM", "EMERG COMMUNICATION", "MERG COMMUNICATIO"), "EMERGENCY COMMUNICATION", df$City_Department_Involved)#Emergency communications

df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("ENVIRON."), "ENVIRONMENT", df$City_Department_Involved)
df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("FAM & SUPPORT SRVCS"), "FAMILY & SUPPORT SERVICES", df$City_Department_Involved)
df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("FIRE", "FIRE DEPT"), "FIRE DEPARTMENT", df$City_Department_Involved)
df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("FLEET MGMT"), "FLEET MANAGEMENT", df$City_Department_Involved)
df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("GEN. SERV."), "GENERAL SERVICES", df$City_Department_Involved)
df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("HOUSING & ECON DEV"), "HOUSING", df$City_Department_Involved)

df$City_Department_Involved <- 
  ifelse(df$City_Department_Involved %in% c("WATER MGMT / SEWERS", "WATER MGMT / SEWER", "WATER", "SEWERS", "SEWER", "WATER MGMT / WATER"), "WATER MANAGEMENT", df$City_Department_Involved)


df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("CDOT"), "TRANSPORTATION", df$City_Department_Involved)

df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("HUMAN RESOURCES"), "HUMAN SERVICES", df$City_Department_Involved)
df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("PUBLIC HEALTH", "DISABILITY"), "HEALTH", df$City_Department_Involved)
df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("PUBLIC LIBRARY"), "LIBRARY", df$City_Department_Involved)
df$City_Department_Involved <- ifelse(df$City_Department_Involved %in% c("S&S"), "STREETS & SANITATION", df$City_Department_Involved)

```

```{r}




#Can also clean primary causes

df %>% filter(City_Department_Involved == "POLICE") %>% {print(unique(.$Primary_Cause))}

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "2FM" & df$Primary_Cause %in% c("MVA - CITY VEHICLE",
                                                                        "MVA / CITY VEHICLE"), "MVA/CITY VEHICLE", df$Primary_Cause)
#-------------------------------------------------------------------------------------------------------------------------------------------#

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "ANIMAL CONTROL" & df$Primary_Cause %in% c("PROPERTY DAMAGE - OTHER", "PDOTH"), "PROPERTY DAMAGE/OTHER", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "ANIMAL CONTROL" & df$Primary_Cause %in% c("PIOTH"), "PERSONAL INJURY/OTHER", df$Primary_Cause)

#-------------------------------------------------------------------------------------------------------------------------------------------#

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "BUILDINGS" & df$Primary_Cause %in% c("DAMAGE TO PROPERTY DURING OPERATIONS"), "PROPERTY DAMAGED DURING OPERATIONS", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "BUILDINGS" & df$Primary_Cause %in% c("PROPERTY DAMAGE - OTHER"), "PROPERTY DAMAGE/OTHER", df$Primary_Cause)

#----------------------------------------------------------------------------------------------------------------------------------------------#

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "EMERGENCY COMMUNICATION" & df$Primary_Cause %in% c("MVA - CITY VEHICLE"), "MVA/CITY VEHICLE", df$Primary_Cause)

#-----------------------------------------------------------------------------------------------------------------------------------------------#

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "FINANCE" & df$Primary_Cause %in% c("PROPERTY DAMAGE - OTHER", "PDOTH"), "PROPERTY DAMAGE/OTHER", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "FINANCE" & df$Primary_Cause %in% c("PDMVA", "MVA - PROPERTY DAMAGE ONLY"), "PROPERTY DAMAGE/MVA", df$Primary_Cause)



#-------------------------------------------------------------------------------------------------------------------------------------------------#

# Fire Continued............


df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "FIRE DEPARTMENT" & df$Primary_Cause %in% c("MVA - CITY VEHICLE"), "MVA/CITY VEHICLE", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "FIRE DEPARTMENT" & df$Primary_Cause %in% c("MVA - PROPERTY DAMAGE ONLY", "PDMVA", "MVA/PROPERTY DAMAGE"), "PROPERTY DAMAGE/MVA", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "FIRE DEPARTMENT" & df$Primary_Cause %in% c("PDOTH", "PROPERTY DAMAGE - OTHER"), "PROPERTY DAMAGE/OTHER", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "FIRE DEPARTMENT" & df$Primary_Cause %in% c("CITY FIRE FIGHTERS REV DISCRIM FROM 1986 LT EXAM"), "FIRE FIGHTERS CLAIM REVERSE DISCRIMINATION ON 1986 LT'S EXAM", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "FIRE DEPARTMENT" & df$Primary_Cause %in% c("TITLE VII DISPARATGE IMPACT", "TITLE VII/DISPARATE IMPACT"), "TITLE Vll DISPARATE IMPACT", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "FIRE DEPARTMENT" & df$Primary_Cause %in% c("RACE DISCRIMINATION, DISPARATE IMPACT", "RACE DISCRIMINATION", "RACE DISCRIMINATION DISPARATE IMPACT"), "RACIAL DISCRIMINATION", df$Primary_Cause)


#--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "GENERAL SERVICES" & df$Primary_Cause %in% c("PERSONAL INJURY - OTHER"), "PERSONAL INJURY OTHER", df$Primary_Cause)

#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#

#Law Continued....................................................

#------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#


df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "LEET MANAGEMEN" & df$Primary_Cause %in% c("MVA - PROPERTY DAMAGE ONLY"), "PROPERTY DAMAGE/MVA", df$Primary_Cause)

#---------------------------------------------------------------#

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "LIBRARY" & df$Primary_Cause %in% c("MVA / CITY VEHICLE"), "MVA/CITY VEHICLE", df$Primary_Cause)

#-----------------------------------------------------------------------------------------------------------------------------------#
#df %>% filter(City_Department_Involved == "POLICE") %>% {print(unique(.$Primary_Cause))}

#df %>% filter(City_Department_Involved == "POLICE" & str_detect(Primary_Cause, "DEATH")) %>% {print(unique(.$Primary_Cause))}


df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("TITLE VII CIVIL RIGHTS ACT OF 1964",
                                                                            "TITLE VII AND CIVIL RIGHTS ACT",
                                                                            "VIOLATION OF TITLE VII"), "TITLE VII", df$Primary_Cause)


df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("TITLE VII NATIONAL ORIGIN",
                                                                           "TITILE VII - NATIONAL ORIGIN"), "TITLE VII/NATIONAL ORIGIN", df$Primary_Cause)



df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("MVA / CITY VEHICLE",
                                                                           "MVA/CITY VEHICLE IN PUBLIC WAY",
                                                                           "MVA - CITY VEHICLE",
                                                                           "VEHICLE COLLISION - CITY VEHICLE",
                                                                           "VEHICLE COLLISIONS - CITY VEHICLE"), "MVA/CITY VEHICLE", df$Primary_Cause)


df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("MVA - PROPERTY DAMAGE",
                                                                           "MVA/PROPERTY DAMAGE",
                                                                           "MVA -PROPERTY DAMAGE ONLY",
                                                                           "MVA - PROPERTY DAMAGE ONLY",
                                                                           "MVA - PROPERTY DAMAGE BIKE"), "PROPERTY DAMAGE/MVA", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("MVA - PEDESTRIAN",
                                                                           "MOTOR VEHICLE/ACCIDENT PEDESTRIAN"), "MVA/PEDESTRIAN", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("MVA/ER - POLICE",
                                                                           "MVA/ER-POLICE",
                                                                           "MVA - EMERGENCY RESPONSE",
                                                                           "POLICE/EMERGENCY RESPONSE"), "MVA/EMERGENCY/POLICE", df$Primary_Cause)
df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("MVA - ER"), "MVA/ER-MEDICAL", df$Primary_Cause)



df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("TITLE V11 - RACE DISCRIMINATION", "TITLE VII DISCRIMINATION", "RACE DISCRIMINATION"), "TITLE VII/DISCRIMINATION", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("SEXUAL DISCRIMINATION & HARASSEMENT"), "SEXUAL HARASSMENT DISCRIMINATION", df$Primary_Cause)


df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("OTHER POLICE MISCONDUCT: NON-INTENT.",
                                                                           "POLICE MISCONDUCT -  OTHER",
                                                                           "OTHER POLICE MISCONDUCT",
                                                                           "POLICE MISCONDUCT"), "POLICE/MISCONDUCT", df$Primary_Cause)



df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("ILLEGAL SEARCH AND SEIZURE",
                                                                           "ILLEGAL SEARCH/SEIZURE",
                                                                           "UNREASONABLE SEARCH & SEIZURE",
                                                                           "UNLAWFUL SEARCH",
                                                                           "ILLEGAL STOP AND SEARCH",
                                                                           "ILLEGAL STOP AND SEARCH",
                                                                           "WRONGFUL SEARCH",
                                                                           "UNLAWFUL SEARCH AND SEIZURE",
                                                                           "UNREASONABLE SEARCH",
                                                                           "ILLEGAL SEARCH & SEIZURE"), "ILLEGAL SEARCH", df$Primary_Cause)


df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("FALSE ARREST/UNLAWFUL SEARCH"), "UNLAWFUL SEARCH/FALSE ARREST", df$Primary_Cause)


df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("EXCESSIVE FORCE/UNLAWFUL SEARCH"), "EXCESSIVE FORCE/ILLEGAL SEARCH", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("ADA FAILURE TO ACCOMMODATE, DISCRIMATION"), "ADA DISCRIMINATION", df$Primary_Cause)



df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("FOIA SUIT",
                                                                           "FOIA ATTORNEY FEES",
                                                                           "FOIA LITIGATION",
                                                                           "FOIA ACTION",
                                                                           "FOIA VIOLATION"), "FOIA", df$Primary_Cause)


df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("CL VEH HIT CPD VEH FRONT END DMG CL VEH BOKUNIEWICZ JOSEPH",
                                                                           "CPD VEH REARENDED CL VEH UNDISCLOSED INJURIES FLAHERTY KENNETH W",
                                                                           "CPD RESCUE-CL BOAT DMGD GASH IN CL BOAT/DMG ANCHR",
                                                                           "CPD V HIT CL VEH LEFT SIDE DAMAGE CL VEH",
                                                                           "CPD VEH HIT CL VEH UNSPECIFIED VEH DAMAGE MENDEZ JEANNE R",
                                                                           "CPD PURSUIT 3 BROKEN WINDOWS",
                                                                           "CPD V BACKED INTO CL VEH FRONT RIGHT DAMAGE CL VEH SCHNEIDER KATHY",
                                                                           "CPD HIT CL VEH IN REAR REAR END DAMAGE CL VEH TIRADO GLORIA",
                                                                           "CPD V HIT CL PARKED VEH LEFT SIDE DAMAGE CL VEH HIGGS MARIA",
                                                                           "CPD V HIT CL PARKED VEH LEFT SIDE DAMAGE CL VEH HIGGS MARIA",
                                                                           "CPD B/INTO CL PARKED VEH MINOR SCRATCHES FRONT END UNKN UNKN"), "UNKNOWN/VEHICLE/POLICE/RELATED", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("PERSONAL INJURY - OTHER", "PIOTH"), "PERSONAL INJURY/OTHER", df$Primary_Cause)



df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("EXCESSIVE FORCE/SERIOUS",
                                                                           "EXCESSIVE FORCE MINOR",
                                                                           "EXCESSIVE FORCE/MALICIOUS PROSECUTION",
                                                                           "EXCESSIVE FORCE/FAILURE TO PROTECT",
                                                                           "EXCESSIVE FORCE/ELBOW STRIKE",
                                                                           "EXCESSIVE DETENITION/MALICIOUS PROSECUTION",
                                                                           "EXCESSIVE FORCE/MINOR",
                                                                           "EXCESSIVE FORCE - SERIOUS",
                                                                           "EXCESSIVE FORCE/FALSE ARREST/EMOTIONAL",
                                                                           "EXCESSIVE FORCE/TASER",
                                                                           "EXCESSIVE FORCE/ILLEGAL SEARCH",
                                                                           "EXCESSIVE FORCE/ILLEGAL SEIZURE",
                                                                           "EXCESSIVE FORCE SERIOUS",
                                                                           "EXCESSIVE FORCE/FAILURE TO INTERVENE",
                                                                           "EXCESSIVE FORCE/DENIAL OF MEDICAL CARE",
                                                                           "EXCESSIVE FORCE/SERIOUS/BURGE REPARATIONS"), "EXCESSIVE FORCE", df$Primary_Cause)

df$Primary_Cause <- 
  ifelse(df$City_Department_Involved == "POLICE" & df$Primary_Cause %in% c("EXCESSIVE FORCE/WRONGFUL DEATH"), "WRONGFUL DEATH", df$Primary_Cause)

```







